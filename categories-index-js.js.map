{"version":3,"sources":["webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/notification/index.js","webpack:///./src/components/categories/index.js","webpack:///./src/pages/categories/index.js","webpack:///./src/utils/fetch-json.js"],"names":["SortableList","constructor","items","clientX","clientY","this","moveDraggingAt","draggingItem","style","zIndex","currentItem","document","elementFromPoint","classList","contains","top","getBoundingClientRect","offsetHeight","height","before","placeholder","after","dragStop","render","element","createElement","add","forEach","item","append","addEventListener","event","onPointerdown","target","closest","preventDefault","dragStart","remove","initialIndex","children","indexOf","initialShift","x","y","width","offsetWidth","onDocumentPointermove","onDocumentPointerup","left","currnetIndex","replaceWith","dispatchEvent","CustomEvent","bubbles","detail","from","to","removeEventListener","destroy","NotificationMessage","message","duration","type","durationInSeconds","Math","floor","innerHTML","template","firstElementChild","show","parent","body","setTimeout","Category","id","title","wrapper","container","querySelector","subcategories","map","category","getCategoryItem","sortableList","getItemTemplate","count","header","parentElement","toggle","Page","async","dataset","categories","find","splice","i","weight","notification","fetchJson","URL","process","method","headers","JSON","stringify","subElements","getSubElements","renderComponents","querySelectorAll","reduce","accum","subElement","data","initEventListeners","onCategoriesPointerdown","onSortableListReorder","components","url","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","status","Error","super","window","reason","alert"],"mappings":"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","file":"categories-index-js.js","sourcesContent":["export default class SortableList {\n  element;\n\n  onDocumentPointermove = ({ clientX, clientY }) => {\n    this.moveDraggingAt(clientX, clientY);\n    this.draggingItem.style.zIndex = -1;\n\n    const currentItem = document.elementFromPoint(clientX, clientY);\n\n    this.draggingItem.style.zIndex = 10000;\n\n    if (!currentItem.classList.contains('sortable-list__item')) return;\n\n    const { top } = currentItem.getBoundingClientRect();\n    const { offsetHeight: height } = currentItem;\n\n    if (clientY < top + height / 2) {\n      currentItem.before(this.placeholder);\n    } else {\n      currentItem.after(this.placeholder);\n    }\n  };\n\n  onDocumentPointerup = () => {\n    this.dragStop();\n  };\n\n  constructor(items = []) {\n    this.items = items;\n\n    this.render();\n  }\n\n  render() {\n    this.element = document.createElement('ul');\n    this.element.classList.add('sortable-list');\n    this.items.forEach(item => item.classList.add('sortable-list__item'));\n    this.element.append(...this.items);\n    this.element.addEventListener('pointerdown', event => this.onPointerdown(event));\n  }\n\n  onPointerdown(event) {\n    const item = event.target.closest('.sortable-list__item');\n\n    if (!item) return;\n\n    event.preventDefault();\n\n    if (event.target.closest('[data-grab-handle')) this.dragStart(event, item);\n    if (event.target.closest('[data-delete-handle]')) item.remove();\n  }\n\n  dragStart({ clientX, clientY }, item) {\n    this.initialIndex = [...this.element.children].indexOf(item);\n    this.initialShift = {\n      x: clientX - item.getBoundingClientRect().x,\n      y: clientY - item.getBoundingClientRect().y\n    };\n\n    this.draggingItem = item;\n    this.placeholder = document.createElement('div');\n    this.placeholder.classList.add('sortable-list__placeholder');\n\n    item.style.width = item.offsetWidth + 'px';\n    item.style.height = item.offsetHeight + 'px';\n    this.placeholder.style.width = item.style.width;\n    this.placeholder.style.height = item.style.height;\n\n    item.classList.add('sortable-list__item_dragging');\n    item.after(this.placeholder);\n    this.element.append(item);\n\n    this.moveDraggingAt(clientX, clientY);\n\n    document.addEventListener('pointermove', this.onDocumentPointermove);\n    document.addEventListener('pointerup', this.onDocumentPointerup);\n  }\n\n  moveDraggingAt(clientX, clientY) {\n    this.draggingItem.style.left = clientX - this.initialShift.x + 'px';\n    this.draggingItem.style.top = clientY - this.initialShift.y + 'px';\n  }\n\n  dragStop() {\n    const currnetIndex = [...this.element.children].indexOf(this.placeholder);\n\n    this.placeholder.replaceWith(this.draggingItem);\n    this.draggingItem.classList.remove('sortable-list__item_dragging');\n    this.draggingItem.style.left = '';\n    this.draggingItem.style.top = '';\n    this.draggingItem.style.width = '';\n    this.draggingItem.style.height = '';\n    this.draggingItem = null;\n\n    if (currnetIndex !== this.initialIndex) {\n      this.element.dispatchEvent(\n        new CustomEvent('sortable-list-reorder', {\n          bubbles: true,\n          detail: {\n            from: this.initialIndex,\n            to: currnetIndex\n          }\n        })\n      );\n    }\n\n    document.removeEventListener('pointermove', this.onDocumentPointermove);\n    document.removeEventListener('pointerup', this.onDocumentPointerup);\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n    document.removeEventListener('pointermove', this.onDocumentPointermove);\n    document.removeEventListener('pointerup', this.onDocumentPointerup);\n  }\n}\n","export default class NotificationMessage {\n  static element = null;\n\n  constructor(message = '', { duration = 2000, type = 'success' } = {}) {\n    if (NotificationMessage.element) NotificationMessage.element.remove();\n\n    this.message = message;\n    this.duration = duration;\n    this.durationInSeconds = Math.floor(duration / 1000) + 's';\n    this.type = type;\n    this.render();\n  }\n\n  get template() {\n    return `\n      <div class=\"notification notification_${this.type} show\" style=\"--value:${\n      this.duration / 1000\n    }s\">\n        <div class=\"notification__content\">\n          ${this.message}\n        </div>\n      </div>\n    `;\n  }\n\n  render() {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n    this.element = element.firstElementChild;\n    NotificationMessage.element = this.element;\n  }\n\n  show(parent = document.body) {\n    parent.append(this.element);\n    setTimeout(() => this.remove(), this.duration);\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n    NotificationMessage.element = null;\n  }\n}\n","import SortableList from '../sortable-list';\n\nexport default class Category {\n  element;\n\n  static onCategoriesPointerdown = event => {\n    const header = event.target.closest('.category__header');\n\n    if (header) header.parentElement.classList.toggle('category_open');\n  };\n\n  constructor(item = {}) {\n    this.item = item;\n\n    this.render();\n  }\n\n  get template() {\n    return `\n\t\t\t<div class=\"category category_open\" data-id=\"${this.item.id}\">\n\t\t\t\t<header class=\"category__header\">${this.item.title}</header>\n\t\t\t\t<div class=\"category__body\">\n\t\t\t\t\t<div class=\"subcategory-list\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n  }\n\n  render() {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.template;\n    this.element = wrapper.firstElementChild;\n\n    const container = this.element.querySelector('.subcategory-list');\n    const items = this.item.subcategories.map(category => this.getCategoryItem(category));\n    const sortableList = new SortableList(items);\n\n    container.append(sortableList.element);\n\n    return this.element;\n  }\n\n  getCategoryItem(category) {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.getItemTemplate(category);\n\n    return wrapper.firstElementChild;\n  }\n\n  getItemTemplate(item) {\n    return `\n\t\t\t<li class=\"categories__sortable-list-item\" data-grab-handle=\"\" data-id=\"${item.id}\">\n\t\t\t\t<strong>${item.title}</strong>\n\t\t\t\t<span><b>${item.count}</b> products</span>\n\t\t\t</li>\n\t\t`;\n  }\n\n  destroy() {\n    this.element.remove();\n  }\n}\n","import Category from '../../components/categories';\nimport NotificationMessage from '../../components/notification';\nimport fetchJson from '../../utils/fetch-json.js';\n\nexport default class Page {\n  element;\n  subElements = {};\n  components = {};\n  categories = [];\n\n  onSortableListReorder = async event => {\n    const { from, to } = event.detail;\n    const id = event.target.closest('[data-id]').dataset.id;\n    const subcategories = this.categories.find(item => item.id === id).subcategories;\n    const category = subcategories.splice(from, 1);\n\n    subcategories.splice(to, 0, ...category);\n    subcategories.forEach((item, i) => (item.weight = i + 1));\n\n    const response = await fetchJson(new URL('api/rest/subcategories', process.env.BACKEND_URL), {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json;charset=utf-8'\n      },\n      body: JSON.stringify(subcategories)\n    });\n\n    let notification;\n\n    if (response) {\n      notification = new NotificationMessage('category order saved');\n    } else {\n      notification = new NotificationMessage('category order didn`t save', { type: 'error' });\n    }\n\n    notification.show();\n  };\n\n  get template() {\n    return `\n\t\t\t<div class=\"categories\">\n\t\t\t\t<div class=\"content__top-panel\">\n\t\t\t\t\t<h1 class=\"page-title\">Categories of goods</h1>\n\t\t\t\t</div>\n\t\t\t\t<div data-element=\"categories\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n  }\n\n  render() {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.template;\n    this.element = wrapper.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    this.renderComponents();\n\n    return this.element;\n  }\n\n  getSubElements(element) {\n    const elements = element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((accum, subElement) => {\n      accum[subElement.dataset.element] = subElement;\n\n      return accum;\n    }, {});\n  }\n\n  async renderComponents() {\n    const url =\n      'https://course-js.javascript.ru/api/rest/categories?_sort=weight&_refs=subcategory';\n    const data = await fetchJson(url);\n    const categories = data.map(item => new Category(item).element);\n\n    this.categories = data;\n    this.subElements.categories.append(...categories);\n    this.initEventListeners();\n  }\n\n  initEventListeners() {\n    this.subElements.categories.addEventListener('pointerdown', Category.onCategoriesPointerdown);\n    this.subElements.categories.addEventListener(\n      'sortable-list-reorder',\n      this.onSortableListReorder\n    );\n  }\n\n  destroy() {\n    this.element.remove();\n    this.subElements = {};\n    this.components = {};\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\n// status >= 400 is an error\n// network error / json error are errors\n\nexport default async function (url, params) {\n  let response;\n\n  try {\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\n    response = await fetch(url.toString(), params);\n  } catch (err) {\n    throw new FetchError(response, 'Network error has occurred.');\n  }\n\n  let body;\n\n  if (!response.ok) {\n    let errorText = response.statusText; // Not Found (for 404)\n\n    try {\n      body = await response.json();\n\n      errorText =\n        (body.error && body.error.message) ||\n        (body.data && body.data.error && body.data.error.message) ||\n        errorText;\n    } catch (error) {\n      /* ignore failed body */\n    }\n\n    let message = `Error ${response.status}: ${errorText}`;\n\n    throw new FetchError(response, body, message);\n  }\n\n  try {\n    return await response.json();\n  } catch (err) {\n    throw new FetchError(response, null, err.message);\n  }\n}\n\nexport class FetchError extends Error {\n  name = 'FetchError';\n\n  constructor(response, body, message) {\n    super(message);\n    this.response = response;\n    this.body = body;\n  }\n}\n\n// handle uncaught failed fetch through\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason instanceof FetchError) {\n    alert(event.reason.message);\n  }\n});\n"],"sourceRoot":""}