(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{12:function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return s}));class s{constructor(e=[]){i(this,"element",void 0),i(this,"onDocumentPointermove",({clientX:e,clientY:t})=>{this.moveDraggingAt(e,t),this.draggingItem.style.zIndex=-1;const n=document.elementFromPoint(e,t);if(this.draggingItem.style.zIndex=1e4,!n.classList.contains("sortable-list__item"))return;const{top:i}=n.getBoundingClientRect(),{offsetHeight:s}=n;t<i+s/2?n.before(this.placeholder):n.after(this.placeholder)}),i(this,"onDocumentPointerup",()=>{this.dragStop()}),this.items=e,this.render()}render(){this.element=document.createElement("ul"),this.element.classList.add("sortable-list"),this.items.forEach(e=>e.classList.add("sortable-list__item")),this.element.append(...this.items),this.element.addEventListener("pointerdown",e=>this.onPointerdown(e))}onPointerdown(e){const t=e.target.closest(".sortable-list__item");t&&(e.preventDefault(),e.target.closest("[data-grab-handle")&&this.dragStart(e,t),e.target.closest("[data-delete-handle]")&&t.remove())}dragStart({clientX:e,clientY:t},n){this.initialIndex=[...this.element.children].indexOf(n),this.initialShift={x:e-n.getBoundingClientRect().x,y:t-n.getBoundingClientRect().y},this.draggingItem=n,this.placeholder=document.createElement("div"),this.placeholder.classList.add("sortable-list__placeholder"),n.style.width=n.offsetWidth+"px",n.style.height=n.offsetHeight+"px",this.placeholder.style.width=n.style.width,this.placeholder.style.height=n.style.height,n.classList.add("sortable-list__item_dragging"),n.after(this.placeholder),this.element.append(n),this.moveDraggingAt(e,t),document.addEventListener("pointermove",this.onDocumentPointermove),document.addEventListener("pointerup",this.onDocumentPointerup)}moveDraggingAt(e,t){this.draggingItem.style.left=e-this.initialShift.x+"px",this.draggingItem.style.top=t-this.initialShift.y+"px"}dragStop(){const e=[...this.element.children].indexOf(this.placeholder);this.placeholder.replaceWith(this.draggingItem),this.draggingItem.classList.remove("sortable-list__item_dragging"),this.draggingItem.style.left="",this.draggingItem.style.top="",this.draggingItem.style.width="",this.draggingItem.style.height="",this.draggingItem=null,e!==this.initialIndex&&this.element.dispatchEvent(new CustomEvent("sortable-list-reorder",{bubbles:!0,detail:{from:this.initialIndex,to:e}})),document.removeEventListener("pointermove",this.onDocumentPointermove),document.removeEventListener("pointerup",this.onDocumentPointerup)}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onDocumentPointermove),document.removeEventListener("pointerup",this.onDocumentPointerup)}}},13:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));class i{constructor(e="",{duration:t=2e3,type:n="success"}={}){i.element&&i.element.remove(),this.message=e,this.duration=t,this.durationInSeconds=Math.floor(t/1e3)+"s",this.type=n,this.render()}get template(){return`\n      <div class="notification notification_${this.type} show" style="--value:${this.duration/1e3}s">\n        <div class="notification__content">\n          ${this.message}\n        </div>\n      </div>\n    `}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,i.element=this.element}show(e=document.body){e.append(this.element),setTimeout(()=>this.remove(),this.duration)}remove(){this.element.remove()}destroy(){this.remove(),i.element=null}}var s,r,o;o=null,(r="element")in(s=i)?Object.defineProperty(s,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[r]=o},8:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return d}));var i=n(12);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class r{constructor(e={}){s(this,"element",void 0),this.item=e,this.render()}get template(){return`\n\t\t\t<div class="category category_open" data-id="${this.item.id}">\n\t\t\t\t<header class="category__header">${this.item.title}</header>\n\t\t\t\t<div class="category__body">\n\t\t\t\t\t<div class="subcategory-list"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild;const t=this.element.querySelector(".subcategory-list"),n=this.item.subcategories.map(e=>this.getCategoryItem(e)),s=new i.a(n);return t.append(s.element),this.element}getCategoryItem(e){const t=document.createElement("div");return t.innerHTML=this.getItemTemplate(e),t.firstElementChild}getItemTemplate(e){return`\n\t\t\t<li class="categories__sortable-list-item" data-grab-handle="" data-id="${e.id}">\n\t\t\t\t<strong>${e.title}</strong>\n\t\t\t\t<span><b>${e.count}</b> products</span>\n\t\t\t</li>\n\t\t`}destroy(){this.element.remove()}}s(r,"onCategoriesPointerdown",e=>{const t=e.target.closest(".category__header");t&&t.parentElement.classList.toggle("category_open")});var o=n(13),a=n(9);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class d{constructor(){l(this,"element",void 0),l(this,"subElements",{}),l(this,"components",{}),l(this,"categories",[]),l(this,"onSortableListReorder",async e=>{const{from:t,to:n}=e.detail,i=e.target.closest("[data-id]").dataset.id,s=this.categories.find(e=>e.id===i).subcategories,r=s.splice(t,1);s.splice(n,0,...r),s.forEach((e,t)=>e.weight=t+1);let l;l=await Object(a.a)(new URL("api/rest/subcategories","https://course-js.javascript.ru/"),{method:"PATCH",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(s)})?new o.a("category order saved"):new o.a("category order didn`t save",{type:"error"}),l.show()})}get template(){return'\n\t\t\t<div class="categories">\n\t\t\t\t<div class="content__top-panel">\n\t\t\t\t\t<h1 class="page-title">Categories of goods</h1>\n\t\t\t\t</div>\n\t\t\t\t<div data-element="categories">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'}render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element),this.renderComponents(),this.element}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}async renderComponents(){const e=await Object(a.a)("https://course-js.javascript.ru/api/rest/categories?_sort=weight&_refs=subcategory"),t=e.map(e=>new r(e).element);this.categories=e,this.subElements.categories.append(...t),this.initEventListeners()}initEventListeners(){this.subElements.categories.addEventListener("pointerdown",r.onCategoriesPointerdown),this.subElements.categories.addEventListener("sortable-list-reorder",this.onSortableListReorder)}destroy(){this.element.remove(),this.subElements={},this.components={}}}},9:function(e,t,n){"use strict";t.a=async function(e,t){let n,s;try{n=await fetch(e.toString(),t)}catch(e){throw new i(n,"Network error has occurred.")}if(!n.ok){let e=n.statusText;try{s=await n.json(),e=s.error&&s.error.message||s.data&&s.data.error&&s.data.error.message||e}catch(e){}let t=`Error ${n.status}: ${e}`;throw new i(n,s,t)}try{return await n.json()}catch(e){throw new i(n,null,e.message)}};class i extends Error{constructor(e,t,n){var i,s,r;super(n),r="FetchError",(s="name")in(i=this)?Object.defineProperty(i,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[s]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof i&&alert(e.reason.message)})}}]);
//# sourceMappingURL=categories-index-js.js.map