{"version":3,"sources":["webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/notification/index.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js","webpack:///./src/utils/fetch-json.js"],"names":["SortableList","constructor","items","clientX","clientY","this","moveDraggingAt","draggingItem","style","zIndex","currentItem","document","elementFromPoint","classList","contains","top","getBoundingClientRect","offsetHeight","height","before","placeholder","after","dragStop","render","element","createElement","add","forEach","item","append","addEventListener","event","onPointerdown","target","closest","preventDefault","dragStart","remove","initialIndex","children","indexOf","initialShift","x","y","width","offsetWidth","onDocumentPointermove","onDocumentPointerup","left","currnetIndex","replaceWith","dispatchEvent","CustomEvent","bubbles","detail","from","to","removeEventListener","destroy","NotificationMessage","message","duration","type","durationInSeconds","Math","floor","innerHTML","template","firstElementChild","show","parent","body","setTimeout","string","replace","ProductForm","productId","URL","process","async","file","subElements","productForm","upload","files","formData","FormData","result","source","name","response","fetchJson","method","headers","Authorization","data","url","link","image","getImageElement","imageListContainer","querySelector","err","console","error","click","customEventName","customEventMessage","JSON","stringify","getFormElementsData","renderForm","addListeners","createFieldset","productName","isReuired","wrapper","escapeHtml","renderImages","images","map","sortableList","getSubElements","querySelectorAll","reduce","acc","subElement","dataset","getOptions","arr","subcategories","subcat","id","title","join","renderCategories","options","subcategory","categories","product","loadProductById","categoriesResponse","productResponse","Promise","all","update","searchParams","set","setCategory","category","select","selectedOption","Array","find","option","value","selected","description","price","discount","quantity","status","elements","toNumber","includes","Number","urls","sources","i","push","uploadImage","onUploadImageClick","onFormSubmit","Page","initComponents","renderComponents","initEventListeners","components","form","params","fetch","toString","FetchError","ok","errorText","statusText","json","Error","super","window","reason","alert"],"mappings":"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","file":"products-edit-index-js.js","sourcesContent":["export default class SortableList {\n  element;\n\n  onDocumentPointermove = ({ clientX, clientY }) => {\n    this.moveDraggingAt(clientX, clientY);\n    this.draggingItem.style.zIndex = -1;\n\n    const currentItem = document.elementFromPoint(clientX, clientY);\n\n    this.draggingItem.style.zIndex = 10000;\n\n    if (!currentItem.classList.contains('sortable-list__item')) return;\n\n    const { top } = currentItem.getBoundingClientRect();\n    const { offsetHeight: height } = currentItem;\n\n    if (clientY < top + height / 2) {\n      currentItem.before(this.placeholder);\n    } else {\n      currentItem.after(this.placeholder);\n    }\n  };\n\n  onDocumentPointerup = () => {\n    this.dragStop();\n  };\n\n  constructor(items = []) {\n    this.items = items;\n\n    this.render();\n  }\n\n  render() {\n    this.element = document.createElement('ul');\n    this.element.classList.add('sortable-list');\n    this.items.forEach(item => item.classList.add('sortable-list__item'));\n    this.element.append(...this.items);\n    this.element.addEventListener('pointerdown', event => this.onPointerdown(event));\n  }\n\n  onPointerdown(event) {\n    const item = event.target.closest('.sortable-list__item');\n\n    if (!item) return;\n\n    event.preventDefault();\n\n    if (event.target.closest('[data-grab-handle')) this.dragStart(event, item);\n    if (event.target.closest('[data-delete-handle]')) item.remove();\n  }\n\n  dragStart({ clientX, clientY }, item) {\n    this.initialIndex = [...this.element.children].indexOf(item);\n    this.initialShift = {\n      x: clientX - item.getBoundingClientRect().x,\n      y: clientY - item.getBoundingClientRect().y\n    };\n\n    this.draggingItem = item;\n    this.placeholder = document.createElement('div');\n    this.placeholder.classList.add('sortable-list__placeholder');\n\n    item.style.width = item.offsetWidth + 'px';\n    item.style.height = item.offsetHeight + 'px';\n    this.placeholder.style.width = item.style.width;\n    this.placeholder.style.height = item.style.height;\n\n    item.classList.add('sortable-list__item_dragging');\n    item.after(this.placeholder);\n    this.element.append(item);\n\n    this.moveDraggingAt(clientX, clientY);\n\n    document.addEventListener('pointermove', this.onDocumentPointermove);\n    document.addEventListener('pointerup', this.onDocumentPointerup);\n  }\n\n  moveDraggingAt(clientX, clientY) {\n    this.draggingItem.style.left = clientX - this.initialShift.x + 'px';\n    this.draggingItem.style.top = clientY - this.initialShift.y + 'px';\n  }\n\n  dragStop() {\n    const currnetIndex = [...this.element.children].indexOf(this.placeholder);\n\n    this.placeholder.replaceWith(this.draggingItem);\n    this.draggingItem.classList.remove('sortable-list__item_dragging');\n    this.draggingItem.style.left = '';\n    this.draggingItem.style.top = '';\n    this.draggingItem.style.width = '';\n    this.draggingItem.style.height = '';\n    this.draggingItem = null;\n\n    if (currnetIndex !== this.initialIndex) {\n      this.element.dispatchEvent(\n        new CustomEvent('sortable-list-reorder', {\n          bubbles: true,\n          detail: {\n            from: this.initialIndex,\n            to: currnetIndex\n          }\n        })\n      );\n    }\n\n    document.removeEventListener('pointermove', this.onDocumentPointermove);\n    document.removeEventListener('pointerup', this.onDocumentPointerup);\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n    document.removeEventListener('pointermove', this.onDocumentPointermove);\n    document.removeEventListener('pointerup', this.onDocumentPointerup);\n  }\n}\n","export default class NotificationMessage {\n  static element = null;\n\n  constructor(message = '', { duration = 2000, type = 'success' } = {}) {\n    if (NotificationMessage.element) NotificationMessage.element.remove();\n\n    this.message = message;\n    this.duration = duration;\n    this.durationInSeconds = Math.floor(duration / 1000) + 's';\n    this.type = type;\n    this.render();\n  }\n\n  get template() {\n    return `\n      <div class=\"notification notification_${this.type} show\" style=\"--value:${\n      this.duration / 1000\n    }s\">\n        <div class=\"notification__content\">\n          ${this.message}\n        </div>\n      </div>\n    `;\n  }\n\n  render() {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n    this.element = element.firstElementChild;\n    NotificationMessage.element = this.element;\n  }\n\n  show(parent = document.body) {\n    parent.append(this.element);\n    setTimeout(() => this.remove(), this.duration);\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n    NotificationMessage.element = null;\n  }\n}\n","export default string =>\n  string\n    .replace(/&/g, '&amp;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;');\n","import SortableList from '../sortable-list/index.js';\nimport escapeHtml from '../../utils/escape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\n\nexport default class ProductForm {\n  element;\n  subElements = {};\n  url = new URL('api/rest/products', process.env.BACKEND_URL);\n\n  constructor(productId) {\n    this.productId = productId;\n\n    this.renderForm();\n    this.addListeners();\n  }\n\n  get template() {\n    return `\n      <div class=\"product-form\">\n        <form data-element=\"productForm\" class=\"form-grid\">\n\n          <div class=\"form-group form-group__half_left\">\n            ${this.createFieldset('Product name', 'title', 'text', 'Product name', true)}\n          </div>\n\n          <div class=\"form-group form-group__wide\">\n            <label class=\"form-label\">Description</label>\n            <textarea required=\"\" class=\"form-control\" name=\"description\"\n            data-form=\"description\" placeholder=\"Product description\"></textarea>\n          </div>\n\n          <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\n            <label class=\"form-label\">Images</label>\n            <div data-element=\"imageListContainer\"></div>\n            <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline\"><span>Upload</span></button>\n            <input data-element=\"upload\" name=\"upload\" type=\"file\" hidden>\n          </div>\n\n          <div class=\"form-group form-group__half_left\">\n            <label class=\"form-label\">Category</label>\n            <select id=\"subcategory\" data-form=\"subcategory\" class=\"form-control\" name=\"subcategory\">              \n            </select>\n          </div>\n\n          <div class=\"form-group form-group__half_left form-group__two-col\">\n            ${this.createFieldset('Price ($)', 'price', 'number', '100', true)}\n            ${this.createFieldset('Discount ($)', 'discount', 'number', '0', true)}\n          </div>\n\n          <div class=\"form-group form-group__part-half\">\n            <label class=\"form-label\">Quantity</label>\n            <input data-form=\"quantity\" required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"1\">\n          </div>\n\n          <div class=\"form-group form-group__part-half\">\n            <label class=\"form-label\">Status</label>\n            <select data-form=\"status\" class=\"form-control\" name=\"status\">\n              <option value=\"1\">Active</option>\n              <option value=\"0\">Inactive</option>\n            </select>\n          </div>\n\n          <div class=\"form-buttons\">\n            <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\n              Save product\n            </button>\n          </div>\n\n        </form>\n      </div>\n    `;\n  }\n\n  createFieldset(productName = '', name = '', type = 'text', placeholder = '', isReuired = false) {\n    return `\n      <fieldset>\n        <label class=\"form-label\">${productName}</label>\n        <input\n          data-form=\"${name}\"\n          class=\"form-control\"\n          name=\"${name}\"\n          type=\"${type}\"\n          placeholder=\"${placeholder}\"\n          required=\"${isReuired}\">\n      </fieldset>\n    `;\n  }\n\n  getImageElement(image = {}) {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = `\n      <li class=\"products-edit__imagelist-item\" style=\"\">\n        <input type=\"hidden\" name=\"url\" value=\"${image.url}\">\n        <input type=\"hidden\" name=\"source\" value=\"${image.source}\">\n        <span>\n          <img src=\"https://anatolysokolov.github.io/project-structure/images/icon-grab.svg\" data-grab-handle=\"\" alt=\"grab\">\n          <img class=\"sortable-table__cell-img\" alt=\"Image\" src=\"${escapeHtml(image.url)}\">\n          <span>${escapeHtml(image.source)}</span>\n        </span>\n        <button type=\"button\">\n          <img src=\"https://anatolysokolov.github.io/project-structure/images/icon-trash.svg\" data-delete-handle=\"\" alt=\"delete\">\n        </button>\n      </li>\n    `;\n\n    return wrapper.firstElementChild;\n  }\n\n  renderImages(images) {\n    const items = images.map(image => this.getImageElement(image));\n    const sortableList = new SortableList(items);\n\n    this.subElements.imageListContainer.append(sortableList.element);\n  }\n\n  renderForm() {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n    this.element = element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n  }\n\n  getSubElements(element) {\n    const elements = element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((acc, subElement) => {\n      acc[subElement.dataset.element] = subElement;\n\n      return acc;\n    }, {});\n  }\n\n  getOptions(arr = []) {\n    return arr\n      .map(item => {\n        return item.subcategories\n          .map(subcat => `<option value=\"${subcat.id}\">${item.title} &gt; ${subcat.title}</option>`)\n          .join('');\n      })\n      .join('');\n  }\n\n  renderCategories(arr = []) {\n    const options = this.getOptions(arr);\n\n    this.subElements.productForm.subcategory.innerHTML = options;\n  }\n\n  async render() {\n    if (!this.productId) {\n      const categories = await fetchJson(\n        `${process.env.BACKEND_URL}api/rest/categories?_sort=weight&_refs=subcategory`\n      );\n\n      if (categories) {\n        this.renderCategories(categories);\n      }\n    } else {\n      const categories = fetchJson(\n        `${process.env.BACKEND_URL}api/rest/categories?_sort=weight&_refs=subcategory`\n      );\n      const product = this.loadProductById(this.productId);\n      const [categoriesResponse, productResponse] = await Promise.all([categories, product]);\n\n      if (categoriesResponse) {\n        this.renderCategories(categoriesResponse);\n      }\n\n      if (productResponse) {\n        this.update(...productResponse);\n      }\n    }\n\n    return this.element;\n  }\n\n  async loadProductById(id) {\n    const url = new URL(this.url);\n\n    url.searchParams.set('id', id);\n\n    return await fetchJson(url);\n  }\n\n  setCategory(category) {\n    const select = this.subElements.productForm.subcategory;\n    const selectedOption = Array.from(select.options).find(option => option.value === category);\n\n    if (selectedOption) selectedOption.selected = true;\n  }\n\n  update(product = {}) {\n    this.subElements.productForm.title.value = product.title;\n    this.subElements.productForm.description.value = product.description;\n    this.setCategory(product.subcategory);\n    this.subElements.productForm.price.value = product.price;\n    this.subElements.productForm.discount.value = product.discount;\n    this.subElements.productForm.quantity.value = product.quantity;\n    this.subElements.productForm.status.value = product.status;\n    this.renderImages(product.images);\n  }\n\n  upload = async () => {\n    const [file] = this.subElements.productForm.upload.files;\n    const formData = new FormData();\n    const result = {\n      source: file.name\n    };\n\n    formData.append('image', file);\n\n    try {\n      const response = await fetchJson('https://api.imgur.com/3/image', {\n        method: 'POST',\n        headers: {\n          Authorization: `Client-ID ${process.env.IMGUR_CLIENT_ID}`\n        },\n        body: formData\n      });\n\n      const { data } = await response;\n\n      result.url = data.link;\n\n      const image = this.getImageElement(result);\n\n      image.classList.add('sortable-list__item');\n      this.subElements.imageListContainer.querySelector('.sortable-list').append(image);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  onUploadImageClick = () => {\n    this.subElements.upload.click();\n  };\n\n  getFormElementsData() {\n    const data = {};\n    const elements = this.element.querySelectorAll('[data-form]');\n    const toNumber = ['price', 'quantity', 'discount', 'status'];\n\n    [...elements].forEach(element => {\n      if (toNumber.includes(element.name)) {\n        data[element.name] = Number(element.value);\n      } else {\n        data[element.name] = element.value;\n      }\n    });\n\n    const urls = this.element.querySelectorAll('[name=\"url\"]');\n    const sources = this.element.querySelectorAll('[name=\"source\"]');\n    data.images = [];\n\n    [...urls].forEach((item, i) => {\n      data.images.push({\n        url: item.value,\n        source: sources[i].value\n      });\n    });\n\n    if (this.productId) data.id = this.productId;\n\n    return data;\n  }\n\n  onFormSubmit = async event => {\n    event.preventDefault();\n\n    const response = await fetchJson(this.url, {\n      method: this.productId ? 'PATCH' : 'PUT',\n      headers: {\n        'Content-Type': 'application/json;charset=utf-8'\n      },\n      body: JSON.stringify(this.getFormElementsData())\n    });\n\n    let customEventName, customEventMessage;\n\n    if (response) {\n      customEventName = 'successful-form-confirmation';\n      customEventMessage = this.productId ? 'product-updated' : 'product-saved';\n    } else {\n      customEventName = 'error-from-confirmation';\n    }\n\n    this.element.dispatchEvent(\n      new CustomEvent(customEventName, {\n        bubbles: true,\n        detail: customEventMessage\n      })\n    );\n  };\n\n  addListeners() {\n    this.subElements.upload.addEventListener('change', this.upload);\n    this.subElements.productForm.uploadImage.addEventListener('click', this.onUploadImageClick);\n    this.subElements.productForm.addEventListener('submit', this.onFormSubmit);\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n    this.subElements = null;\n  }\n}\n","import ProductForm from '../../../components/product-form';\nimport NotificationMessage from '../../../components/notification';\nimport escapeHtml from '../../../utils/escape-html.js';\nimport fetchJson from '../../../utils/fetch-json.js';\n\nexport default class Page {\n  element;\n  subElements = {};\n  components = {};\n\n  constructor(productId) {\n    this.productId = productId;\n  }\n\n  get template() {\n    return `\n\t\t\t<div class=\"products-edit\">\n\n\t\t\t\t<div class=\"content__top-panel\">\n\t\t\t\t\t<h1 class=\"page-title\">\n\t\t\t\t\t\t<a href=\"/products\" class=\"link\">Products</a>\n\t\t\t\t\t\t\t/ Add\n\t\t\t\t\t</h1>\n\t\t\t\t</div>\n\n\t\t\t\t<div data-element=\"productForm\" class=\"content-box\"></div>\n\n\t\t\t</div>\n\t\t`;\n  }\n\n  render() {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.template;\n    this.element = wrapper.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    this.initComponents();\n    this.renderComponents();\n    this.initEventListeners();\n\n    return this.element;\n  }\n\n  getSubElements(element) {\n    const elements = element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((acc, subElement) => {\n      acc[subElement.dataset.element] = subElement;\n\n      return acc;\n    }, {});\n  }\n\n  initComponents() {\n    const productForm = new ProductForm(this.productId);\n\n    this.components = { productForm };\n  }\n\n  async renderComponents() {\n    const form = await this.components.productForm.render();\n    const container = this.subElements.productForm;\n\n    container.append(form);\n  }\n\n  initEventListeners() {\n    this.components.productForm.element.addEventListener('successful-form-confirmation', event => {\n      const message = event.detail;\n      const notification = new NotificationMessage(message);\n\n      notification.show();\n    });\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\n// status >= 400 is an error\n// network error / json error are errors\n\nexport default async function (url, params) {\n  let response;\n\n  try {\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\n    response = await fetch(url.toString(), params);\n  } catch (err) {\n    throw new FetchError(response, 'Network error has occurred.');\n  }\n\n  let body;\n\n  if (!response.ok) {\n    let errorText = response.statusText; // Not Found (for 404)\n\n    try {\n      body = await response.json();\n\n      errorText =\n        (body.error && body.error.message) ||\n        (body.data && body.data.error && body.data.error.message) ||\n        errorText;\n    } catch (error) {\n      /* ignore failed body */\n    }\n\n    let message = `Error ${response.status}: ${errorText}`;\n\n    throw new FetchError(response, body, message);\n  }\n\n  try {\n    return await response.json();\n  } catch (err) {\n    throw new FetchError(response, null, err.message);\n  }\n}\n\nexport class FetchError extends Error {\n  name = 'FetchError';\n\n  constructor(response, body, message) {\n    super(message);\n    this.response = response;\n    this.body = body;\n  }\n}\n\n// handle uncaught failed fetch through\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason instanceof FetchError) {\n    alert(event.reason.message);\n  }\n});\n"],"sourceRoot":""}